{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["/**\n * Convert path to route object\n *\n * A string or RegExp should be passed,\n * will return { re, src, keys} obj\n *\n * @param  {String / RegExp} path\n * @return {Object}\n */\n\nvar Route = function (path) {\n  //using 'new' is optional\n\n  var re,\n    keys = []\n\n  if (path instanceof RegExp) re = path\n  else re = pathToRegExp(path, keys)\n\n  return {\n    re,\n    src: path.toString(),\n    keys,\n  }\n}\n\n/**\n * Normalize the given path string,\n * returning a regular expression.\n *\n * An empty array should be passed,\n * which will contain the placeholder\n * key names. For example \"/user/:id\" will\n * then contain [\"id\"].\n *\n * @param  {String} path\n * @param  {Array} keys\n * @return {RegExp}\n */\nvar pathToRegExp = function (path, keys) {\n  path = path\n    .concat('/?')\n    .replace(/\\/\\(/g, '(?:/')\n    .replace(\n      /(\\/)?(\\.)?:(\\w+)(?:(\\(.*?\\)))?(\\?)?|\\*/g,\n      function (_, slash, format, key, capture, optional) {\n        if (_ === '*') {\n          keys.push(undefined)\n          return _\n        }\n\n        keys.push(key)\n        slash = slash || ''\n        return (\n          '' +\n          (optional ? '' : slash) +\n          '(?:' +\n          (optional ? slash : '') +\n          (format || '') +\n          (capture || '([^/]+?)') +\n          ')' +\n          (optional || '')\n        )\n      }\n    )\n    .replace(/([\\/.])/g, '\\\\$1')\n    .replace(/\\*/g, '(.*)')\n  return new RegExp('^' + path + '$', 'i')\n}\n\n/**\n * Attempt to match the given request to\n * one of the routes. When successful\n * a  {fn, params, splats} obj is returned\n *\n * @param  {Array} routes\n * @param  {String} uri\n * @return {Object}\n */\nvar match = function (routes, uri, startAt) {\n  var captures,\n    i = startAt || 0\n\n  for (var len = routes.length; i < len; ++i) {\n    var route = routes[i],\n      re = route.re,\n      keys = route.keys,\n      splats = [],\n      params = {}\n\n    if ((captures = uri.match(re))) {\n      for (var j = 1, len = captures.length; j < len; ++j) {\n        var key = keys[j - 1],\n          val =\n            typeof captures[j] === 'string'\n              ? unescape(captures[j])\n              : captures[j]\n        if (key) {\n          params[key] = val\n        } else {\n          splats.push(val)\n        }\n      }\n      return {\n        params: params,\n        splats: splats,\n        route: route.src,\n        next: i + 1,\n      }\n    }\n  }\n}\n\n/**\n * Default \"normal\" router constructor.\n * accepts path, fn tuples via addRoute\n * returns {fn, params, splats, route}\n *  via match\n *\n * @return {Object}\n */\n\nvar Router = function () {\n  //using 'new' is optional\n  return {\n    routes: [],\n    routeMap: {},\n    addRoute: function (path, fn) {\n      if (!path) throw new Error(' route requires a path')\n      if (!fn)\n        throw new Error(' route ' + path.toString() + ' requires a callback')\n\n      if (this.routeMap[path]) {\n        throw new Error('path is already defined: ' + path)\n      }\n\n      var route = Route(path)\n      route.fn = fn\n\n      this.routes.push(route)\n      this.routeMap[path] = fn\n    },\n\n    removeRoute: function (path) {\n      if (!path) throw new Error(' route requires a path')\n      if (!this.routeMap[path]) {\n        throw new Error('path does not exist: ' + path)\n      }\n\n      var newRoutes = []\n\n      // copy the routes excluding the route being removed\n      for (var i = 0; i < this.routes.length; i++) {\n        var route = this.routes[i]\n        if (route.src !== path) {\n          newRoutes.push(route)\n        }\n      }\n      this.routes = newRoutes\n      delete this.routeMap[path]\n    },\n\n    match: function (pathname, startAt) {\n      var route = match(this.routes, pathname, startAt)\n      if (route) {\n        route.fn = this.routeMap[route.route]\n        route.next = this.match.bind(this, pathname, route.next)\n      }\n      return route\n    },\n  }\n}\n\nRouter.Route = Route\nRouter.pathToRegExp = pathToRegExp\nRouter.match = match\n// back compat\nRouter.Router = Router\n\nmodule.exports = Router\n"],"names":["require_index_es","__commonJSMin","exports","module","Route","path","re","keys","pathToRegExp","_","slash","format","key","capture","optional","match","routes","uri","startAt","captures","i","len","route","splats","params","j","val","Router","fn","newRoutes","pathname"],"mappings":"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"}